ch05.Elixirビルド時に何が起こっているか
=======================================

makeコマンドでElixirをビルドする時、何が起こっているかをいくつかのフェーズに分けて説明していきます。

### 全体の流れ

makeを行うとMakefileの内容でElixirがビルドされます。ビルドは大きく以下のフェーズに分けられます。

1. rebarを使ってErlangで記述されたElixirコンパイラをコンパイル
2. Elixirコンパイラを使ってElixirで記述されたカーネルをコンパイル
3. Elixirコンパイラを使ってElixirで記述された標準ライブラリをコンパイル
4. Elixirコンパイラを使ってElixirで記述されたUnicodeモジュールをコンパイル
5. Elixirコンパイラを使ってElixirで記述された関連ツール(eex,mix,ex_unit,logger,iex)をコンパイル

### Elixirコンパイラ

makeコマンドを実行するとまずElixirコンパイラがコンパイルされます。この時、以下の処理が実行されます。

```bash
cd /path/to/elixir/repo/lib/elixir && ../../rebar compile
```

コンパイルの順は以下となります。

1. elixir/src/elixir.app.srcをelixir/lib/elixir/srcにコピーする
2. elixir/lib/elixir/src以下のErlangコードをコンパイルしてelixir/lib/elixir/ebin以下に実行ファイル(.beam,.app)として配置する

src以下のErlangソースコードは4種類あります。

##### elixir.app.src

elixir.app.srcはelixir.appのテンプレートファイルです。これを元にelixir.appとしてebin以下に配置されます。

##### elixir.hrl

elixir.hrlはErlangのヘッダファイルです。Elixirコンパイラモジュールに関する定義等が記述されています。

##### elixir_xxx.erl

elixir_xxx.erlはErlangのソースコードです。 コンパイルされるとebin以下にelixir_xxx.beamとして配置されます。

##### elixir_parser.yrl

elixir_parser.yrlはyeccパーサージェネレーターファイル、yeccはErlangのLALR(1)パーサージェネレータです。

パーサージェネレータとは何ぞやという方は、(yeccではなくyacc,raccなんですが) RHGの[速習yacc](http://i.loveruby.net/ja/rhg/book/yacc.html)、[Rubyを256倍使うための本 無道編](http://www.amazon.co.jp/Rubyを256倍使うための本-無道編-青木-峰郎/dp/4756137091)をオススメします。

yeccの詳しい使い方は[Erlangの公式ドキュメント](http://erlang.org/doc/man/yecc.html)を参照して下さい。 まとまった日本語の情報は残念ながら見つけられませんでした。 yeccについてはパース関連の章で掘り下げて説明します。

コンパイルが走ると、elixir_parser.yrlからelixir_parser.erl が生成され、さらにebin以下にelixir_parser.beamができます。

### Elixirカーネル

### 標準ライブラリ

### Unicodeモジュール

### 関連ツール(eex,mix,ex_unit,logger,iex)
